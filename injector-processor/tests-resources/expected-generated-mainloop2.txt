package injector.apt;

import injector.*;
import java.util.List;
import java.util.concurrent.Executors;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.TimeUnit;

/**
* Auto generated server configuration for {@link injector.apt.MainloopAnnotatedClass}.
*/
@ExposedAs( Job.class )
@javax.annotation.processing.Generated("injector.apt.MainloopMethodProcessor")
public class MainloopAnnotatedClassMainloopRunner1 implements Job {

    private static final ExecutorService BACKGROUND = Executors.newFixedThreadPool(2);
    private static boolean JOB_MAY_RUN = true;

    static {
        Runtime.getRuntime().addShutdownHook(new Thread() {
            public void run() {
                try {
                    JOB_MAY_RUN = false;
                    BACKGROUND.shutdown();
                    if (!BACKGROUND.awaitTermination(30, TimeUnit.SECONDS)) {
                        final List<Runnable> droppedTasks = BACKGROUND.shutdownNow();
                        System.err.println(
                            "Executor was abruptly shut down. " + droppedTasks.size() + " tasks will not be executed.");
                    }
                } catch (final InterruptedException cause) {
                    cause.printStackTrace();
                }
            }
        });
    }

    private final MainloopAnnotatedClass instance;

    public MainloopAnnotatedClassMainloopRunner1( final MainloopAnnotatedClass instance ){
        this.instance = instance;
    }

    public void execute() throws Exception {
        for ( int i=0; i<2; i++ ) {
            BACKGROUND.submit( new Runnable() {

                @Override
                public void run(){
                    try {
                        while( JOB_MAY_RUN ){
                            instance.execute2();
                        }
                    } catch( final Throwable cause ) {
                        System.err.println(
                            "Failed to execute MainloopAnnotatedClass.execute2 in background. Aborted." );
                        cause.printStackTrace();
                    }
                }
            });
        }
    }
}
